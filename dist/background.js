(()=>{"use strict";console.log("4ndr0tools Service Worker Loaded"),chrome.runtime.onInstalled.addListener(()=>{console.log("4ndr0tools extension installed")}),chrome.commands.onCommand.addListener(async e=>{if("clear-site-data"===e)try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e.url)return;const t=new URL(e.url).origin;await chrome.browsingData.remove({origins:[t]},{cookies:!0,localStorage:!0,indexedDB:!0,webSQL:!0,cache:!0}),e.id&&await chrome.scripting.executeScript({target:{tabId:e.id},func:()=>{try{sessionStorage.clear()}catch(e){console.log("SessionStorage clear failed:",e)}}}),chrome.action.setBadgeText({text:"✓",tabId:e.id}),chrome.action.setBadgeBackgroundColor({color:"#15FFFF",tabId:e.id}),setTimeout(()=>{chrome.action.setBadgeText({text:"",tabId:e.id})},2e3),!1!==(await chrome.storage.sync.get(["autoReload"])).autoReload&&chrome.tabs.reload(e.id)}catch(e){console.error("Site clearance failed:",e);const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});t.id&&(chrome.action.setBadgeText({text:"✗",tabId:t.id}),chrome.action.setBadgeBackgroundColor({color:"#FF4444",tabId:t.id}),setTimeout(()=>{chrome.action.setBadgeText({text:"",tabId:t.id})},2e3))}}),chrome.runtime.onMessage.addListener((e,t,o)=>{if("clearSiteData"===e.action)return async function(){const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e.url)throw new Error("No active tab");const t=new URL(e.url).origin;await chrome.browsingData.remove({origins:[t]},{cookies:!0,localStorage:!0,indexedDB:!0,webSQL:!0,cache:!0}),e.id&&await chrome.scripting.executeScript({target:{tabId:e.id},func:()=>sessionStorage.clear()})}().then(()=>o({success:!0})).catch(e=>o({success:!1,error:e.message})),!0;o({success:!1,error:"Unknown action"})})})();